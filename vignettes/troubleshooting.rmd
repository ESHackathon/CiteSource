---
title: "troubleshooting"

author: ""

date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{troubleshooting}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10,
  fig.height = 10,
  warning = FALSE
)
```
## About this vignette

This vignette is strictly for internal troubleshooting

```{r, results = FALSE, message=FALSE}
#Install the remotes packages to enable installation from GitHub
#install.packages("remotes")
#library(remotes)

#Install CiteSource
#remotes::install_github("ESHackathon/CiteSource")

#Load the necessary libraries
library(CiteSource)
library(dplyr)
```


```{r}
#Import citation files from a folder
citation_files <- list.files(path = file.path("../vignettes/troubleshooting"), pattern = "\\.ris", full.names = TRUE)

#Print citation_files to double check the order in which R imported our files.
citation_files
```

```{r}
# Import citation files from folder
citation_files <- list.files(path = "working_example_data", pattern = "\\.ris", full.names = TRUE)

# Print list of citation files to console
citation_files

# Set the path to the directory containing the citation files
file_path <- "../vignettes/troubleshooting/"

metadata_tbl <- tibble::tribble(
  ~files,           ~cite_sources, ~cite_labels, 
   "ProcessedDIM.ris",   "DIM",       "processed",    
   "ProcessedLENS.ris",  "LENS",      "processed",    
   "RAWDIM.ris",         "DIM",       "raw",    
   "RAWLENS.ris",        "LENS",      "raw",     

) %>% 

dplyr::mutate(files = paste0(file_path, files))

citations <- read_citations(metadata = metadata_tbl)

```

```{r echo=TRUE, results='asis'}
# Load the knitr package
library(DT)
datatable(citations %>% select(-abstract), options = list(pageLength = 10))
```


```{r}
dedup_results_raw <- dedup_citations(citations %>% filter(cite_label == "raw"), merge_citations = TRUE)
dedup_results_processed <- dedup_citations(citations %>% filter(cite_label == "processed"), merge_citations = TRUE)

unique_citations_raw <- dedup_results_raw$unique
unique_citations_processed <- dedup_results_processed$unique

# Count number of unique and non-unique citations from different sources and labels
if (nrow(unique_citations_raw) == nrow(unique_citations_processed)) message("Deduplication likely identical")
```

